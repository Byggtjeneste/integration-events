# Company events

The events related to companies will be sent from Byggtjeneste's Subscription System to an Azure Service Bus queue for consumption by the Avensia middleware. The "participant type" can be determined from the subscriptions.

## Properties

| Property              | Type     | Required     | Nullable |
| --------------------- | -------- | ------------ | -------- |
| `data`                | `object` | **Required** | No       |
| `metadata`            | `object` | **Required** | No       |

### metadata

`object` with the following properties:

| Property          | Type    | Required     | Description |
| ------------------| ------- | ------------ | ------- |
| `eventType`       | string  | **Required** | Either "Create" or "Update".
| `event`           | string  | **Required** | Always "Company" for company events.
| `date`            | string  | **Required** | Date and time in UTC for the action in Riversand that triggered the event. In format `yyyy'-'MM'-'dd'T'HH':'mm':'ss`. Example value: `2020-02-27T23:39:46`.
| `author`          | string  | **Required** | Author of the action that triggered the event.

### data
The data model depends on the event type, see below.

# Company created

## Preconditions
- The company has a NOBB participant number.

## Properties

### data

`object` with the following properties:

| Property                | Type    		| Required     | Description 															| Riversand Comment
| ----------------------- | ------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------ | --------------------
| `id`                    | string  		| **Required** | GUID generated by the Subscription System											| **TBD**
| `nobbParticipantNumber` | integer 		| **Required** | Unique integer generated by the Subscription System										| **TBD**
| `active`                | boolean 		| **Required** | 																| **TBD**
| `address`               | object  		| **Optional** | Optional but most likely populated as it comes from a registrar.								| **TBD**
| `billingAddress`        | object  		| **Required** | Required to add a subscription to the company. If this is not populated, then the company won't have an active subscription.	| **TBD**
| `description`           | string  		| **Optional** | 																| **TBD**	
| `efoParticipantNumber`  | array of integers 	| **Optional** | Participant number(s) for company in EFO database										| **TBD**	
| `email`                 | string  		| **Optional** | 																| **TBD**
| `glnNumbers`            | array of strings 	| **Optional** | Global Location Numbers													| **TBD**
| `logoUrl`               | string  		| **Optional** | 																| **TBD**			
| `marketingName`         | string  		| **Required** | 																| **TBD**	
| `name`                  | string  		| **Required** |																| **TBD**	
| `nrfParticipantNumbers` | array of integers 	| **Optional** | Participant number(s) for company in NRF database										| **TBD**	
| `organizationNumber`    | string  		| **Optional** | 																| **TBD**	
| `parentCompanyId`       | string  		| **Optional** | GUID of parent company. Default is null.											| **TBD**	
| `phone`                 | string  		| **Optional** |																| **TBD**	
| `subscriptions`         | array of objects 	| **Required** |																| **TBD**	
| `vvsCompany`            | boolean 		| **Required** | Internal usage.														| **TBD**
| `website`               | string  		| **Optional** | External URI to company website												| **TBD**	


#### subscription

`object` with the following properties:

| Property     	| Type   | Required     | Description |
| ------------ 	| ------ | ------------ | ----------- |
| `product`    	| string | **Required** | Some irrelevant products may appear here, this is just for informational use. Middleware should filter by product: SupplierSolution. If the company doesn't have a product: SupplierSolution subscription, then they do not have an active subscription.
| `level`    	| string | **Required** | This will include the subscription type to the product, which is what level the company has on the product. Can be related to company type etc as this could hold the information like supplier or retailer.

#### address

`object` with the following properties:

| Property     | Type   | Required     | Description 		| Riversand Comment
| ------------ | ------ | ------------ | ---------------------- | --------------------
| `address`    | string | **Required** |			| **TBD**	
| `country`    | string | **Required** | 2 character ISO code	| **TBD**
| `postalArea` | string | **Required** |			| **TBD**
| `postalCode` | string | **Required** |			| **TBD**



#### billingAddress

`object` with the following properties:

| Property     | Type   | Required     | Description 		| Riversand Comment
| ------------ | ------ | ------------ | ---------------------- | --------------------
| `address`    | string | **Required** |			| **TBD**	
| `country`    | string | **Required** | 2 character ISO code	| **TBD**	
| `postalArea` | string | **Required** |			| **TBD**	
| `postalCode` | string | **Required** |			| **TBD**	



### Sample JSON

```json
{
	"metadata": {
		"eventType": "Create",
		"event": "Company",
		"date": "2019-09-30T12:34:56",
		"author": "Norsk Byggtjeneste AS"
	},
	
	"data": {
		"id": "4f214662-ba42-491c-b230-37b1420a4db9",
		"nobbParticipantNumber": 51128,
		
		"name": "Glava AS",
		"marketingName": "Glava AS",
		"organizationNumber": "943049467",
		"efoParticipantNumber": [44322],
		"nrfParticipantNumbers": [1060, 1061],
		"glnNumbers": ["3250617851367"],
		"parentCompanyId": "4f214662-ba42-491c-b230-37b1420a4db9",
		"active": true,
		"vvsCompany": false,
		"subscriptions": [
			{"product": "Supplier Solution", "level": "The Level/Type - TBD"},
			{"product": "Nobb Kontrakt", "level": "API" }
		],
		"address": {
			"address": "Nybr√•tveien 2",
			"postalCode": "1832",
			"postalArea": "Askim",
			"country": "NO"
		},
		"billingAddress": {
			"address": "Postboks 2006",
			"postalCode": "1801",
			"postalArea": "Askim",
			"country": "NO"
		},
		"email": "firmapost@glava.no",
		"phone": null,
		"website": "https://glava.no",
		"description": null,
		"logoUrl": "https://glava.no/images/somelogo.jpg"
	}
}
```

# Company updated

## Note
The identifiers will be part of the event data. Otherwise, only changed fields will be part of the event data. If there is a change inside a list field (like "nrfParticipantNumbers"), the whole list will be part of the event data.

## Properties

### data

`object` with following properties:

| Property                | Type    | Required     | Description |
| ----------------------- | ------- | ------------ | ------- |
| `id`                    | string  | **Required** | The identifier to the company that should be updated
| `nobbParticipantNumber` | integer | **Required** | The participant number of the company that should be updated
| `active`                | boolean | **Optional** | 
| `address`               | object  | **Optional** | 
| `billingAddress`        | object  | **Optional** | 
| `description`           | string  | **Optional** | 
| `efoParticipantNumber`  | array of integers | **Optional** | Any change to this field must include the whole array
| `email`                 | string  | **Optional** | 
| `glnNumbers`            | array of strings | **Optional** | Any change to this field must include the whole array
| `logoUrl`               | string  | **Optional** | 
| `marketingName`         | string  | **Optional** | 
| `name`                  | string  | **Optional** | 
| `nrfParticipantNumbers` | array of integers | **Optional** | Any change to this field must include the whole array
| `organizationNumber`    | string  | **Optional** | 
| `parentCompanyId`       | string  | **Optional** | 
| `phone`                 | string  | **Optional** |
| `subscriptions`         | array of objects | **Optional** | Any change to this field must include the whole array
| `vvsCompany`            | boolean | **Optional** |
| `website`               | string  | **Optional** |

#### subscription

`object` with the following properties:

| Property     | Type   | Required     | Description |
| ------------ | ------ | ------------ | ----------- |
| `product`    | string | **Required** |
| `level`      | string | **Required** |

#### address

`object` with the following properties:

| Property     | Type   | Required     | Description |
| ------------ | ------ | ------------ | ----------- |
| `address`    | string | **Optional** |
| `country`    | string | **Optional** | 2 character ISO code
| `postalArea` | string | **Optional** |
| `postalCode` | string | **Optional** |



#### billingAddress

`object` with the following properties:

| Property     | Type   | Required     | Description |
| ------------ | ------ | ------------ | ----------- |
| `address`    | string | **Optional** |
| `country`    | string | **Optional** | 2 character ISO code
| `postalArea` | string | **Optional** |
| `postalCode` | string | **Optional** |

### Sample JSON

Example of updating marketing name and adding an NRF participant number:

```json
{
	"metadata": {
		"eventType": "Update",
		"event": "Company",
		"date": "2019-09-30T12:34:56",
		"author": "Glava AS"
	},
	
	"data": {
		"id": "4f214662-ba42-491c-b230-37b1420a4db9",
		"nobbParticipantNumber": 51128,

		"marketingName": "Glava", 
		"nrfParticipantNumbers": [1060, 1061, 1062]		
	}
}

```
