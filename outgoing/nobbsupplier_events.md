# NOBB Supplier events

The events related to NOBB Supplier companies will be sent from Byggtjeneste's Subscription System to an Azure Service Bus queue for consumption by the Avensia middleware. 

## Properties

| Property              | Type     | Required     | Nullable |
| --------------------- | -------- | ------------ | -------- |
| `data`                | `object` | **Required** | No       |
| `metadata`            | `object` | **Required** | No       |

### metadata

`object` with the following properties:

| Property          | Type    | Required     | Description |
| ------------------| ------- | ------------ | ------- |
| `eventType`       | string  | **Required** | Either "Create" or "Update".
| `event`           | string  | **Required** | Always "NobbSupplier" for company events.
| `date`            | string  | **Required** | Date and time in UTC for the action in Riversand that triggered the event. In format `yyyy'-'MM'-'dd'T'HH':'mm':'ss`. Example value: `2020-02-27T23:39:46`.
| `author`          | string  | **Required** | Author of the action that triggered the event.

### data
The data model depends on the event type, see below.

# NOBB Supplier created

## Preconditions
- The company has a NOBB participant number.

## Properties

### data

`object` with the following properties:

| Property                | Type    		| Required     | Riversand Comment 						| Description 															
| ----------------------- | ------------------- | ------------ | -------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ 
| `id`                    | string  		| **Required** | `ptypartyid`							| Unique identifier for the NOBB Supplier generated by the Subscription System											
| `nobbParticipantNumber` | integer 		| **Required** | `ptynobbparticipantnumber`					| Unique integer generated by the Subscription System																
| `address`               | object  		| **Optional** | **TBD**							| Optional but most likely populated as it comes from a registrar.								
| `billingAddress`        | object  		| **Required** | **TBD**							| Required to add a subscription to the company. If this is not populated, then the company won't have an active subscription.	
| `description`           | string  		| **Optional** | **No mapping**							|  																	
| `efoParticipantNumber`  | array of integers 	| **Optional** | `ptyefoparticipantnumber` (multiselect textbox)		| Participant number(s) for company in EFO database											
| `email`                 | string  		| **Optional** | `ptycustomerserviceemail`					| 																
| `glnNumbers`            | array of strings 	| **Optional** | **TBD** (only single select in party?)				| Global Location Numbers													
| `logoUrl`               | string  		| **Optional** | **TBD**							|  																			
| `marketingName`         | string  		| **Required** | `ptymarketingname`						|	  																	
| `name`                  | string  		| **Required** | `ptypartyname`							| 																	
| `nrfParticipantNumbers` | array of integers 	| **Optional** | `ptynrfparticipantnumber` (multiselect textbox)		| Participant number(s) for company in NRF database											
| `organizationNumber`    | string  		| **Optional** | `ptyorgnumber`							|  																	
| `parentCompanyId`       | string  		| **Optional** | `grouptocompany` (Relationship)				| ID of parent company. Default is null.												
| `phone`                 | string  		| **Optional** | `ptycustomerservicephonenumber`				| 																	
| `subscriptions`         | array of objects 	| **Required** | **TBD**							| 			
| `vvsCompany`            | boolean 		| **Required** | No mapping (Only used internal communication) 			| Internal usage.														
| `website`               | string  		| **Optional** | `ptycustomerwebadress`						| External URI to company website													


#### subscription

`object` with the following properties:

| Property     	| Type   | Required     | Riversand Comment		| Description 
| ------------ 	| ------ | ------------ | ----------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
| `product`    	| string | **Required** | rdcertificate::**TBD**	| Some irrelevant products may appear here, this is just for informational use. Middleware should filter by product: "NOBB Supplier". If the company doesn't have a product: "NOBB Supplier" subscription, then they do not have an active subscription.
| `level`    	| string | **Required** | rdcertificate::**TBD**	| Not relevant for NOBB Supplier subscription as of today. 
| `active`    	| boolean | **Required** | ptyactive	| Indicates whether the subscription is active or not. If this flag is set to false for the "NOBB Supplier" subscription, no users of this company should be able to log in to Riversand.

#### address

`object` with the following properties:

| Property     | Type   | Required     | Riversand Comment	| Description 		
| ------------ | ------ | ------------ | ---------------------- | --------------------
| `address`    | string | **Required** | **TBD**		| 
| `country`    | string | **Required** | **TBD**		| 2 character ISO code
| `postalArea` | string | **Required** | **TBD**		|
| `postalCode` | string | **Required** | **TBD**		|



#### billingAddress

`object` with the following properties:

| Property     | Type   | Required     | Riversand Comment 	| Description
| ------------ | ------ | ------------ | ---------------------- | --------------------
| `address`    | string | **Required** | **TBD**		| 	
| `country`    | string | **Required** | **TBD**		| 2 character ISO code	
| `postalArea` | string | **Required** | **TBD**		| 	
| `postalCode` | string | **Required** | **TBD**	 	| 	



### Sample JSON

```json
{
	"metadata": {
		"eventType": "Create",
		"event": "NobbSupplier",
		"date": "2019-09-30T12:34:56",
		"author": "Norsk Byggtjeneste AS"
	},
	
	"data": {
		"id": "51128",
		"nobbParticipantNumber": 51128,
		"name": "Glava AS",
		"marketingName": "Glava AS",
		"organizationNumber": "943049467",
		"efoParticipantNumber": [44322],
		"nrfParticipantNumbers": [1060, 1061],
		"glnNumbers": ["3250617851367"],
		"parentCompanyId": "51130",
		"vvsCompany": false,
		"subscriptions": [
			{"product": "NOBB Supplier", "level": "N/A", "active": true},
			{"product": "Nobb Kontrakt", "level": "API", "active": true }
		],
		"address": {
			"address": "Nybr√•tveien 2",
			"postalCode": "1832",
			"postalArea": "Askim",
			"country": "NO"
		},
		"billingAddress": {
			"address": "Postboks 2006",
			"postalCode": "1801",
			"postalArea": "Askim",
			"country": "NO"
		},
		"email": "firmapost@glava.no",
		"phone": null,
		"website": "https://glava.no",
		"description": null,
		"logoUrl": "https://glava.no/images/somelogo.jpg"
	}
}
```

# NOBB Supplier updated

## Note
The identifiers will be part of the event data. Otherwise, all fields will be part of the message. If an optional field value is removed it will be assigned "null". If there is a change inside a list field (like "nrfParticipantNumbers"), the whole list will be part of the event data.

## Properties

### data

`object` with following properties:

| Property                | Type    		| Required     | Riversand Comment						| Description 
| ----------------------- | ------------------- | ------------ | -------------------------------------------------------------- | ------------------------------------------------------------
| `id`                    | string  		| **Required** | `ptypartyid`							| The identifier to the company that should be updated
| `nobbParticipantNumber` | integer 		| **Required** | `ptynobbparticipantnumber`					| The participant number of the company that should be updated
| `address`               | object  		| **Optional** | **TBD**							|  
| `billingAddress`        | object  		| **Required** | **TBD**							|  
| `description`           | string  		| **Optional** | **No mapping**							|  
| `efoParticipantNumber`  | array of integers 	| **Optional** | `ptyefoparticipantnumber` (multiselect textbox)		| Any change to this field must include the whole array
| `email`                 | string  		| **Optional** | `ptycustomerserviceemail`					| 
| `glnNumbers`            | array of strings 	| **Optional** | **TBD** (only single select in party?)				| Any change to this field must include the whole array
| `logoUrl`               | string  		| **Optional** | **TBD**							|  
| `marketingName`         | string  		| **Required** | `ptymarketingname`						|  
| `name`                  | string  		| **Required** | `ptypartyname`							|  
| `nrfParticipantNumbers` | array of integers 	| **Optional** | `ptynrfparticipantnumber` (multiselect textbox)		| Any change to this field must include the whole array
| `organizationNumber`    | string 		| **Optional** | `ptyorgnumber`							|  
| `parentCompanyId`       | string  		| **Optional** | `grouptocompany` (Relationship)				|  
| `phone`                 | string  		| **Optional** | `ptycustomerservicephonenumber`				| 
| `subscriptions`         | array of objects 	| **Required** | **TBD**							| This vs `Active`? Any change to this field must include the whole array
| `vvsCompany`            | boolean 		| **Required** | No mapping (Only used internal communication) 			| 
| `website`               | string  		| **Optional** | `ptycustomerwebadress`						| 

#### subscription

`object` with the following properties:

| Property     | Type   | Required     | Riversand Comment		| Description 
| ------------ | ------ | ------------ | ------------------------------ | ----------------------
| `product`    | string | **Required** |  rdcertificate::**TBD**	|
| `level`      | string | **Required** |  rdcertificate::**TBD**	|
| `active`    	| boolean | **Required** | ptyactive	| 


#### address

`object` with the following properties:

| Property     | Type   | Required     | Riversand Comment	| Description 
| ------------ | ------ | ------------ | ---------------------- | ----------------------
| `address`    | string | **Optional** | **TBD**		|
| `country`    | string | **Optional** | **TBD**		| 2 character ISO code
| `postalArea` | string | **Optional** | **TBD**		|
| `postalCode` | string | **Optional** | **TBD**		|



#### billingAddress

`object` with the following properties:

| Property     | Type   | Required     | Riversand Comment	| Description 
| ------------ | ------ | ------------ | ---------------------- | ----------------------
| `address`    | string | **Optional** | **TBD**		|
| `country`    | string | **Optional** | **TBD**		| 2 character ISO code
| `postalArea` | string | **Optional** | **TBD**		|
| `postalCode` | string | **Optional** | **TBD**		|

### Sample JSON

```json
{
	"metadata": {
		"eventType": "Update",
		"event": "NobbSupplier",
		"date": "2019-09-30T12:34:56",
		"author": "Norsk Byggtjeneste AS"
	},
	
	"data": {
		"id": "51128",
		"nobbParticipantNumber": 51128,
		"name": "Glava AS",
		"marketingName": "Glava",
		"organizationNumber": "943049467",
		"efoParticipantNumber": [44322],
		"nrfParticipantNumbers": [1060, 1061, 1062],
		"glnNumbers": ["3250617851367"],
		"parentCompanyId": "51130",
		"vvsCompany": false,
		"subscriptions": [
			{"product": "NOBB Supplier", "level": "N/A", "active": true},
			{"product": "Nobb Kontrakt", "level": "API", "active": true }
		],
		"address": {
			"address": "Nybr√•tveien 2",
			"postalCode": "1832",
			"postalArea": "Askim",
			"country": "NO"
		},
		"billingAddress": {
			"address": "Postboks 2006",
			"postalCode": "1801",
			"postalArea": "Askim",
			"country": "NO"
		},
		"email": "firmapost@glava.no",
		"phone": null,
		"website": "https://glava.no",
		"description": null,
		"logoUrl": "https://glava.no/images/somelogo.jpg"
	}
}
```
